version: '3.8'

services:
  frankmd:
    image: frankmd:local
    pull_policy: never
    container_name: frankmd
    restart: unless-stopped
    # Rodar como root para evitar problemas de permissão em volumes montados no Windows
    user: "0:0"
    ports:
      - "7591:80"
    volumes:
      # Caminhos absolutos fixos para garantir que as notas fiquem na sua pasta do Windows
      - "D:/Projetos Interno Pessoais/FrankMD/notas-cofre:/rails/notes"
      - "D:/Projetos Interno Pessoais/FrankMD/images:/rails/images"
    environment:
      # IMPORTANTE: Altere esta chave em produção ou coloque no .env
      - SECRET_KEY_BASE=${SECRET_KEY_BASE:-substitua_por_uma_chave_longa_e_segura}
      - NOTES_PATH=/rails/notes
      - IMAGES_PATH=/rails/images
      
      # Opcional: Idioma (en, pt-BR, es, etc)
      - FRANKMD_LOCALE=pt-BR

      # Se quiser usar IA futuramente, adicione as chaves aqui:
      # - GEMINI_API_KEY=sua_chave
      # - AI_PROVIDER=google
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/up"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
